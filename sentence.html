<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ë¬¸ì¥ ì™„ì„± â€” ì°¬í¬ ì˜ì–´ ë‹¨ì–´ì¥</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; touch-action: manipulation; }
    :root {
      --primary: #5b4fcf; --primary-light: #7c71e0; --primary-bg: #eef2ff;
      --green: #10b981; --yellow: #f59e0b; --red: #ef4444;
      --bg: #f1f5f9; --card: #ffffff; --text: #1e293b; --muted: #64748b; --border: #e2e8f0; --radius: 14px;
    }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Malgun Gothic', sans-serif; background: var(--bg); color: var(--text); }
    .hb-btn { position: fixed; top: 14px; left: 14px; z-index: 300; background: var(--card); border: 2px solid var(--border); border-radius: 12px; width: 46px; height: 46px; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 5px; cursor: pointer; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
    .hb-btn span { display: block; width: 20px; height: 2.5px; background: var(--text); border-radius: 2px; }
    .hb-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.45); z-index: 400; display: none; }
    .hb-overlay.open { display: block; }
    .hb-drawer { position: absolute; left: 0; top: 0; bottom: 0; width: 290px; background: var(--card); padding: 24px 20px 32px; transform: translateX(-100%); transition: transform 0.25s cubic-bezier(0.4,0,0.2,1); }
    .hb-overlay.open .hb-drawer { transform: translateX(0); }
    .hb-hd { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
    .hb-title { font-size: 18px; font-weight: 800; color: var(--primary); }
    .hb-close { background: none; border: none; font-size: 26px; cursor: pointer; color: var(--muted); }
    .hb-unit { background: var(--primary-bg); border-radius: 10px; padding: 10px 14px; margin-bottom: 14px; font-size: 13px; color: var(--primary); font-weight: 600; line-height: 1.6; }
    .hb-mode-btn { width: 100%; padding: 13px 16px; text-align: left; background: var(--bg); border: 2px solid var(--border); border-radius: var(--radius); font-size: 15px; font-weight: 700; cursor: pointer; margin-bottom: 8px; display: flex; align-items: center; gap: 10px; transition: all 0.15s; }
    .hb-mode-btn:hover { border-color: var(--primary); background: var(--primary-bg); }
    .hb-mode-btn.current { border-color: var(--primary); background: var(--primary-bg); color: var(--primary); }
    html, body { height: 100%; }
    #app { height: 100dvh; display: flex; flex-direction: column; overflow: hidden; }
    .page { height: 100%; display: flex; flex-direction: column; overflow: hidden; padding: 16px; padding-bottom: 0; max-width: 860px; margin: 0 auto; width: 100%; }

    /* HEADER */
    .screen-header { display: flex; align-items: center; gap: 10px; margin-bottom: 6px; flex-shrink: 0; }
    .back-btn { background: none; border: none; font-size: 22px; cursor: pointer; color: var(--muted); padding: 4px 8px; border-radius: 8px; }
    .back-btn:hover { background: var(--border); }
    .header-title { flex: 1; font-size: 16px; font-weight: 700; }
    .progress-text { font-size: 13px; color: var(--muted); white-space: nowrap; font-weight: 600; }

    /* UNIT TITLE */
    .unit-title { font-size: 13px; color: var(--muted); text-align: center; margin-bottom: 8px; flex-shrink: 0; }
    .unit-title strong { color: var(--primary); }

    /* WORD BANK */
    .word-bank-wrap { flex-shrink: 0; background: var(--card); border: 1px solid var(--border); border-radius: var(--radius); padding: 10px 14px 12px; margin-bottom: 12px; }
    .word-bank-label { font-size: 11px; font-weight: 700; letter-spacing: .06em; color: var(--muted); text-transform: uppercase; margin-bottom: 8px; }
    .word-bank { display: flex; flex-wrap: wrap; gap: 8px; min-height: 34px; }
    .word-tile {
      display: inline-flex; align-items: center; padding: 6px 14px;
      background: var(--primary); color: #fff; border-radius: 20px;
      font-size: 14px; font-weight: 700; cursor: grab;
      box-shadow: 0 2px 8px rgba(91,79,207,0.25);
      transition: transform 0.12s, opacity 0.2s, box-shadow 0.12s;
      user-select: none; -webkit-user-select: none; touch-action: none;
    }
    .word-tile:hover  { transform: translateY(-2px); box-shadow: 0 4px 14px rgba(91,79,207,0.35); }
    .word-tile:active { cursor: grabbing; transform: scale(0.95); }
    .word-tile.used   { opacity: 0.2; pointer-events: none; }
    .word-tile.dragging { opacity: 0.35; }

    /* DRAG GHOST */
    #drag-ghost {
      position: fixed; pointer-events: none; z-index: 9998;
      background: var(--primary); color: #fff; border-radius: 20px;
      padding: 6px 16px; font-size: 14px; font-weight: 700;
      box-shadow: 0 6px 20px rgba(91,79,207,0.45);
      opacity: 0.92; transform: scale(1.08);
      display: none; white-space: nowrap;
    }

    /* SENTENCES */
    .sentences-wrap { flex: 1; overflow-y: auto; padding-bottom: 16px; }
    .sentence-row {
      background: var(--card); border: 2px solid var(--border); border-radius: var(--radius);
      padding: 14px 16px; margin-bottom: 10px; font-size: 16px; line-height: 2;
      transition: border-color 0.2s, background 0.2s;
    }
    .sentence-row.done { border-color: var(--green); background: rgba(16,185,129,0.05); }
    .sentence-row.over  { border-color: var(--primary); background: var(--primary-bg); }
    .sentence-row.wrong { border-color: var(--red) !important; background: rgba(239,68,68,0.08) !important; transition: none; }
    @keyframes rowShake {
      0%,100% { transform: translateX(0); }
      20%      { transform: translateX(-8px); }
      40%      { transform: translateX(8px); }
      60%      { transform: translateX(-5px); }
      80%      { transform: translateX(5px); }
    }
    .sentence-row.wrong { animation: rowShake 0.4s ease; }
    .s-no { font-size: 12px; font-weight: 700; color: var(--muted); margin-right: 6px; }
    .s-kr  { display: block; font-size: 13px; color: var(--muted); margin-top: 2px; padding-left: 22px; line-height: 1.5; }

    /* BLANK */
    .s-blank {
      display: inline-block; min-width: 72px; height: 30px;
      border-bottom: 2.5px dashed var(--primary-light);
      margin: 0 3px; vertical-align: middle;
      border-radius: 6px 6px 0 0;
      text-align: center; line-height: 30px;
      font-weight: 700; font-size: 15px;
      transition: background 0.15s, border-color 0.15s;
      cursor: pointer;
    }
    .s-blank.over    { background: rgba(91,79,207,0.1); border-bottom-color: var(--primary); }
    .s-blank.filled  { border-bottom: 2.5px solid var(--green); background: rgba(16,185,129,0.12); color: var(--green); padding: 0 10px; min-width: auto; border-radius: 6px; cursor: default; }
    .s-blank.wrong-anim { animation: shake 0.4s ease; }
    @keyframes shake {
      0%,100% { transform: translateX(0); }
      20%      { transform: translateX(-9px); }
      40%      { transform: translateX(9px); }
      60%      { transform: translateX(-6px); }
      80%      { transform: translateX(6px); }
    }

    /* EMPTY STATE */
    .empty-msg { text-align: center; color: var(--muted); padding: 40px 20px; font-size: 15px; line-height: 1.8; }

    /* CELEBRATION (same as study.html) */
    #celebration { display: none; position: fixed; inset: 0; z-index: 9999; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; overflow: hidden; background: linear-gradient(135deg, #f97316, #ec4899, #8b5cf6, #3b82f6); background-size: 400% 400%; animation: bgShift 2s ease infinite; }
    #celebration.show { display: flex; }
    @keyframes bgShift { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }
    .cele-main-emoji { font-size: 90px; animation: spin 1s linear infinite; display: block; }
    @keyframes spin { from{transform:rotate(0deg)} to{transform:rotate(360deg)} }
    .cele-msg { font-size: 46px; font-weight: 900; color: #fff; text-align: center; padding: 0 20px; text-shadow: 0 4px 24px rgba(0,0,0,0.4); animation: cpulse 0.45s ease-in-out infinite alternate; margin: 16px 0 8px; }
    .cele-sub { font-size: 22px; color: rgba(255,255,255,0.95); text-align: center; padding: 0 20px; animation: cpulse 0.45s 0.2s ease-in-out infinite alternate; }
    .cele-tap { position: absolute; bottom: 30px; font-size: 15px; color: rgba(255,255,255,0.7); }
    @keyframes cpulse { from{transform:scale(1)} to{transform:scale(1.1)} }
    .fly-emoji { position: absolute; font-size: 36px; pointer-events: none; animation: flyUp linear forwards; }
    @keyframes flyUp { 0%{transform:translateY(0) rotate(0deg);opacity:1} 100%{transform:translateY(-110vh) rotate(720deg);opacity:0} }

    .toast { position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%); background: #1e293b; color: #fff; padding: 10px 20px; border-radius: 30px; font-size: 14px; opacity: 0; transition: opacity 0.3s; pointer-events: none; z-index: 999; }
    .toast.show { opacity: 1; }
  </style>
</head>
<body>
<button class="hb-btn" onclick="hbOpen()"><span></span><span></span><span></span></button>
<div class="hb-overlay" id="hb-overlay" onclick="if(event.target===this)hbClose()">
  <div class="hb-drawer">
    <div class="hb-hd"><div class="hb-title">ğŸ“š í•™ìŠµ ë©”ë‰´</div><button class="hb-close" onclick="hbClose()">âœ•</button></div>
    <div class="hb-unit" id="hb-unit"></div>
    <button class="hb-mode-btn" onclick="hbGo('home')">ğŸ  ì²˜ìŒìœ¼ë¡œ</button>
    <button class="hb-mode-btn" onclick="hbGo('study')">ğŸƒ í”Œë˜ì‹œì¹´ë“œ</button>
    <button class="hb-mode-btn current" onclick="hbClose()">ğŸ§© ë¬¸ì¥ ì™„ì„± (í˜„ì¬)</button>
    <button class="hb-mode-btn" onclick="hbGo('daily')">ğŸ“ Daily Test</button>
  </div>
</div>
<div id="app">
  <div class="page">
    <div class="screen-header">
      <button class="back-btn" onclick="goHome()">â†</button>
      <div class="header-title">âœï¸ ë¬¸ì¥ ì™„ì„±</div>
      <div class="progress-text" id="progress-text">0 / 0</div>
    </div>
    <div class="unit-title" id="unit-title"></div>

    <div class="word-bank-wrap">
      <div class="word-bank-label">ğŸ“¦ ë‹¨ì–´ ëª©ë¡ â€” ë“œë˜ê·¸í•´ì„œ ë¹ˆì¹¸ì— ë„£ìœ¼ì„¸ìš”</div>
      <div class="word-bank" id="word-bank"></div>
    </div>

    <div class="sentences-wrap" id="sentences-wrap"></div>
  </div>
</div>

<div id="drag-ghost"></div>

<div id="celebration" onclick="hideCelebration()">
  <span class="cele-main-emoji" id="cele-emoji"></span>
  <div class="cele-msg" id="cele-msg"></div>
  <div class="cele-sub" id="cele-sub"></div>
  <div class="cele-tap">ğŸ‘† íƒ­í•´ì„œ ë‹«ê¸°</div>
</div>
<div class="toast" id="toast"></div>

<script>
const params   = new URLSearchParams(location.search);
const courseId = params.get('c');
const typeId   = params.get('t');
const unitId   = params.get('u');

let manifest    = null;
let sentences   = []; // { word, display, sentence, korean, filled }
let wrongCounts = []; // ë¬¸ì¥ë³„ ì˜¤ë‹µ íšŸìˆ˜

// â”€â”€ INIT â”€â”€
(async () => {
  if (!courseId || !typeId || !unitId) { location.href = 'index.html'; return; }
  try {
    const [mRes, dRes] = await Promise.all([
      fetch('data/index.json'),
      fetch(`data/${courseId}/${typeId}/${unitId}.json`)
    ]);
    manifest = await mRes.json();
    const data = await dRes.json();
    renderUnitTitle();
    buildSentences(data.words);
    renderAll();
  } catch(e) {
    showToast('âš ï¸ íŒŒì¼ ë¡œë”© ì‹¤íŒ¨');
  }
})();

function escapeRegex(s) { return s.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'); }

function buildSentences(words) {
  sentences = [];
  words.forEach(w => {
    if (!w.sentence) return;
    const display = w.answer || w.english;   // ë‹¨ì–´ ëª©ë¡Â·ë¹ˆì¹¸ í‘œì‹œëŠ” answer ê¸°ì¤€
    const answerLower = display.toLowerCase();
    sentences.push({
      word:    answerLower,   // íƒ€ì¼ keyë„ answer ê¸°ì¤€
      display: display,       // íƒ€ì¼Â·ë¹ˆì¹¸ì— ë³´ì´ëŠ” í…ìŠ¤íŠ¸
      answer:  answerLower,
      sentence: w.sentence,
      korean:  w.korean || '',
      filled:  false
    });
  });
  // ìˆœì„œ ì„ê¸°
  for (let i = sentences.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [sentences[i], sentences[j]] = [sentences[j], sentences[i]];
  }
  wrongCounts = new Array(sentences.length).fill(0);
}

function renderAll() {
  renderWordBank();
  renderSentences();
  updateProgress();
}

// â”€â”€ WORD BANK â”€â”€
function renderWordBank() {
  const bank = document.getElementById('word-bank');
  bank.innerHTML = '';
  // ë¬¸ì¥ ìˆœì„œì™€ ë³„ê°œë¡œ ë‹¨ì–´ ëª©ë¡ ë…ë¦½ ì…”í”Œ
  const seen = new Set();
  const uniqueWords = [];
  sentences.forEach(s => { if (!seen.has(s.word)) { seen.add(s.word); uniqueWords.push(s); } });
  for (let i = uniqueWords.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [uniqueWords[i], uniqueWords[j]] = [uniqueWords[j], uniqueWords[i]];
  }
  uniqueWords.forEach(s => {
    const isUsed = sentences.filter(x => x.word === s.word).every(x => x.filled);
    const tile = document.createElement('div');
    tile.className = 'word-tile' + (isUsed ? ' used' : '');
    tile.textContent = s.display;
    tile.dataset.word = s.word;
    tile.draggable = true;
    tile.addEventListener('dragstart', onDragStart);
    tile.addEventListener('dragend',   onDragEnd);
    tile.addEventListener('touchstart', onTouchStart, { passive: false });
    bank.appendChild(tile);
  });
}

function refreshTileState(word) {
  // ê°™ì€ ë‹¨ì–´(answer)ë¥¼ ì‚¬ìš©í•˜ëŠ” ëª¨ë“  ë¬¸ì¥ì´ ì±„ì›Œì¡Œìœ¼ë©´ íƒ€ì¼ ë¹„í™œì„±í™”
  const isUsed = sentences.filter(s => s.answer === word || s.word === word).every(s => s.filled);
  const tile = document.querySelector(`.word-tile[data-word="${CSS.escape(word)}"]`);
  if (tile) { tile.classList.toggle('used', isUsed); tile.classList.remove('dragging'); }
}

// â”€â”€ SENTENCES â”€â”€
function renderSentences() {
  const wrap = document.getElementById('sentences-wrap');
  wrap.innerHTML = '';

  if (sentences.length === 0) {
    wrap.innerHTML = `<div class="empty-msg">âš ï¸ ì´ ë‹¨ì›ì—ëŠ” ì˜ˆë¬¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.<br>ë‹¨ì–´ ë°ì´í„°ì— sentence í•„ë“œê°€ í•„ìš”í•©ë‹ˆë‹¤.</div>`;
    return;
  }

  sentences.forEach((s, idx) => {
    const row = document.createElement('div');
    row.className = 'sentence-row' + (s.filled ? ' done' : '');
    row.dataset.idx = idx;

    const filled   = s.filled;
    const blankSpan = `<span class="s-blank ${filled ? 'filled' : ''}" data-idx="${idx}" data-answer="${s.answer}">${filled ? s.display : ''}</span>`;
    const sentHtml  = s.sentence.replace('___', blankSpan);

    row.innerHTML = `<span class="s-no">${idx + 1}.</span> ${sentHtml}`;

    if (!s.filled) {
      row.addEventListener('dragover',  onRowDragOver);
      row.addEventListener('dragleave', onRowDragLeave);
      row.addEventListener('drop',      onRowDrop);
    }

    wrap.appendChild(row);
  });
}

function updateProgress() {
  const done = sentences.filter(s => s.filled).length;
  document.getElementById('progress-text').textContent = `${done} / ${sentences.length}`;
  if (sentences.length > 0 && done === sentences.length) {
    const isPerfect = wrongCounts.every(c => c === 0);
    setTimeout(() => showCelebration(isPerfect), 500);
  }
}

// â”€â”€ DESKTOP DRAG & DROP â”€â”€
let draggedWord = null;

function onDragStart(e) {
  draggedWord = e.currentTarget.dataset.word;
  e.dataTransfer.setData('text/plain', draggedWord);
  e.dataTransfer.effectAllowed = 'move';
  e.currentTarget.classList.add('dragging');
}
function onDragEnd(e) {
  e.currentTarget.classList.remove('dragging');
}
function onRowDragOver(e) {
  e.preventDefault();
  e.dataTransfer.dropEffect = 'move';
  e.currentTarget.classList.add('over');
}
function onRowDragLeave(e) {
  if (!e.currentTarget.contains(e.relatedTarget)) {
    e.currentTarget.classList.remove('over');
  }
}
function onRowDrop(e) {
  e.preventDefault();
  const row = e.currentTarget;
  row.classList.remove('over');
  const blank = row.querySelector('.s-blank:not(.filled)');
  if (!blank) return;
  const word = e.dataTransfer.getData('text/plain') || draggedWord;
  checkAnswer(blank, word);
  draggedWord = null;
}

// â”€â”€ TOUCH DRAG (iPad / ëª¨ë°”ì¼) â”€â”€
let touchWord  = null;
let touchGhost = null;

function onTouchStart(e) {
  const tile = e.currentTarget;
  if (tile.classList.contains('used')) return;
  e.preventDefault();
  touchWord  = tile.dataset.word;
  const ghost = document.getElementById('drag-ghost');
  ghost.textContent = tile.textContent;
  ghost.style.display = 'block';
  const t = e.touches[0];
  moveGhost(ghost, t.clientX, t.clientY);
  tile.classList.add('dragging');
  document.addEventListener('touchmove', onTouchMove, { passive: false });
  document.addEventListener('touchend',  onTouchEnd);
}

function onTouchMove(e) {
  e.preventDefault();
  const t = e.touches[0];
  moveGhost(document.getElementById('drag-ghost'), t.clientX, t.clientY);
  // ë“œë˜ê·¸ ì˜¤ë²„ í•˜ì´ë¼ì´íŠ¸ â€” ë¬¸ì¥ ì „ì²´ ì˜ì—­ ê¸°ì¤€
  document.querySelectorAll('.sentence-row.over').forEach(el => el.classList.remove('over'));
  const el = document.elementFromPoint(t.clientX, t.clientY);
  const row = el?.closest('.sentence-row:not(.done)');
  if (row) row.classList.add('over');
}

function onTouchEnd(e) {
  document.getElementById('drag-ghost').style.display = 'none';
  document.querySelectorAll('.sentence-row.over').forEach(el => el.classList.remove('over'));
  document.removeEventListener('touchmove', onTouchMove);
  document.removeEventListener('touchend',  onTouchEnd);

  const t = e.changedTouches[0];
  const el = document.elementFromPoint(t.clientX, t.clientY);
  const row = el?.closest('.sentence-row:not(.done)');
  if (row) {
    const blank = row.querySelector('.s-blank:not(.filled)');
    if (blank) checkAnswer(blank, touchWord);
  }
  // dragging í´ë˜ìŠ¤ ì œê±°
  const tile = document.querySelector(`.word-tile[data-word="${CSS.escape(touchWord)}"]`);
  if (tile) tile.classList.remove('dragging');
  touchWord = null;
}

function moveGhost(ghost, x, y) {
  ghost.style.left = (x - ghost.offsetWidth  / 2) + 'px';
  ghost.style.top  = (y - ghost.offsetHeight / 2 - 24) + 'px';
}

// â”€â”€ ANSWER CHECK â”€â”€
function checkAnswer(blank, word) {
  if (!word || blank.classList.contains('filled')) return;
  const answer = blank.dataset.answer;
  if (word.toLowerCase() === answer) {
    // âœ… ì •ë‹µ
    const idx = parseInt(blank.dataset.idx);
    sentences[idx].filled = true;
    blank.textContent = sentences[idx].display;
    blank.classList.add('filled');
    blank.classList.remove('over');
    const row = blank.closest('.sentence-row');
    row.removeEventListener('dragover',  onRowDragOver);
    row.removeEventListener('dragleave', onRowDragLeave);
    row.removeEventListener('drop',      onRowDrop);
    row.classList.add('done');
    refreshTileState(word.toLowerCase());
    updateProgress();
  } else {
    // âŒ ì˜¤ë‹µ â€” row ì „ì²´ + blank í”ë“¤ê¸° + í‹€ë¦° íšŸìˆ˜ ê¸°ë¡
    const idx = parseInt(blank.dataset.idx);
    wrongCounts[idx] = (wrongCounts[idx] || 0) + 1;
    updateWrongDisplay(idx);
    blank.classList.remove('over');
    // blank í”ë“¤ê¸°
    blank.classList.add('wrong-anim');
    blank.addEventListener('animationend', () => blank.classList.remove('wrong-anim'), { once: true });
    // row ì „ì²´ ë¹¨ê°„ í”Œë˜ì‹œ (iPadì—ì„œ ì˜ ë³´ì´ë„ë¡)
    const row = blank.closest('.sentence-row');
    row.classList.add('wrong');
    row.addEventListener('animationend', () => row.classList.remove('wrong'), { once: true });
  }
}

function updateWrongDisplay(idx) {
  const row = document.querySelector(`.sentence-row[data-idx="${idx}"]`);
  if (!row) return;
  const no = row.querySelector('.s-no');
  if (!no) return;
  const cnt = wrongCounts[idx];
  no.innerHTML = `${idx + 1}.<span style="color:#ef4444;font-weight:800;margin-left:5px">(${cnt})</span>`;
}

// â”€â”€ UNIT TITLE â”€â”€
function renderUnitTitle() {
  if (!manifest) return;
  const course = manifest.courses.find(c => c.id === courseId);
  const type   = course?.types.find(t => t.id === typeId);
  const unit   = type?.units.find(u => u.id === unitId);
  const el = document.getElementById('unit-title');
  if (!el) return;
  const parts = [course?.label, type?.label, unit?.label].filter(Boolean);
  el.innerHTML = parts.map((p, i) => i === parts.length - 1 ? `<strong>${p}</strong>` : p).join(' &middot; ');
}

function goHome() { location.href = 'index.html'; }

function hbOpen() {
  document.getElementById('hb-unit').textContent = `${courseId} Â· ${typeId} Â· ${unitId}`;
  document.getElementById('hb-overlay').classList.add('open');
}
function hbClose() { document.getElementById('hb-overlay').classList.remove('open'); }
function hbGo(mode) {
  hbClose();
  const p = new URLSearchParams({ c: courseId, t: typeId, u: unitId });
  if (mode === 'home') { location.href = 'index.html'; return; }
  const map = { study: 'study.html', daily: 'daily.html' };
  location.href = `${map[mode]}?${p}`;
}

// â”€â”€ CELEBRATION â”€â”€
const CELE_PERFECT = [
  { emoji: 'ğŸ¥³', msg: 'ğŸ‘ í¼í™íŠ¸!! ğŸ‘',     sub: 'í•œë²ˆë„ ì•ˆ í‹€ë¦¬ê³  ë‹¤ ë§ì·„ì–´!! ğŸ”¥ğŸ”¥ğŸ”¥' },
  { emoji: 'ğŸ†', msg: 'ì°¬í¬ ì§„ì§œ ì²œì¬!!',    sub: 'ì™„ë²½í•´!! ë…¸ë¯¸ìŠ¤ í´ë¦¬ì–´!! ğŸ’¯ğŸ’¯ğŸ’¯' },
  { emoji: 'ğŸ˜', msg: 'ì™„ì „ ëŒ€ë°• í¼í™íŠ¸!!',  sub: 'í•œ ë¬¸ì œë„ ì•ˆ í‹€ë ¸ì–´!! ìµœê°•!! ğŸ‘ğŸ‘ğŸ‘' },
  { emoji: 'ğŸŒŸ', msg: 'ë…¸ë¯¸ìŠ¤ í´ë¦¬ì–´!!',     sub: 'í‹€ë¦° ê²Œ í•˜ë‚˜ë„ ì—†ì–´!! ì—„ì§€ì²™!! ğŸ‘ŠğŸ‘ŠğŸ‘Š' },
  { emoji: 'ğŸ’¯', msg: '100ì  ë§Œì  í¼í™íŠ¸!!', sub: 'ì§„ì§œ ì§±ì´ì•¼!! ìµœê³  ìµœê³ !! â­â­â­' },
];
const CELE_DONE = [
  { emoji: 'ğŸ˜„', msg: 'ëª¨ë‘ ì™„ì„±!',   sub: 'í‹€ë¦° ë¬¸ì œë¥¼ ë‹¤ì‹œ í™•ì¸í•´ë´ìš” ğŸ’ª' },
  { emoji: 'âœ…', msg: 'ì „ë¶€ ì±„ì› ì–´!', sub: 'ë‹¤ìŒì—” í¼í™íŠ¸ ë„ì „! ğŸ‘' },
];
const FLY_EMOJIS = ['ğŸ‰','ğŸŠ','â­','ğŸŒŸ','ğŸ‘','ğŸ†','ğŸ˜„','ğŸ¥³','âœ¨','ğŸ’¯','ğŸ¯','ğŸ”¥','ğŸ˜','ğŸˆ','ğŸ'];

function showCelebration(isPerfect) {
  const pool = isPerfect ? CELE_PERFECT : CELE_DONE;
  const pick = pool[Math.floor(Math.random() * pool.length)];
  document.getElementById('cele-emoji').textContent = pick.emoji;
  document.getElementById('cele-msg').textContent   = pick.msg;
  document.getElementById('cele-sub').textContent   = pick.sub;
  const cel = document.getElementById('celebration');
  cel.classList.add('show');
  // í¼í™íŠ¸: ì´ëª¨ì§€ 60ê°œ ë¹ ë¥´ê²Œ / ì¼ë°˜: 20ê°œ
  const total    = isPerfect ? 60 : 20;
  const interval = isPerfect ? 80 : 200;
  let count = 0;
  const iv = setInterval(() => {
    if (count++ > total) { clearInterval(iv); return; }
    const el = document.createElement('span');
    el.className = 'fly-emoji';
    el.textContent = FLY_EMOJIS[Math.floor(Math.random() * FLY_EMOJIS.length)];
    el.style.left = (Math.random() * 95) + 'vw';
    el.style.bottom = '-50px';
    el.style.animationDuration = (1.0 + Math.random() * 1.5) + 's';
    cel.appendChild(el);
    el.addEventListener('animationend', () => el.remove());
  }, interval);
}
function hideCelebration() { document.getElementById('celebration').classList.remove('show'); }

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg; t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 3000);
}
</script>
</body>
</html>